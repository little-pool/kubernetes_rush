# 查看svc
kubectl  get svc | grep jenkins
NAME            TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE
jenkins         ClusterIP   10.99.124.103   <none>        8080/TCP       3m7s
jenkins-agent   ClusterIP   10.98.21.139    <none>        50000/TCP      3m6s

# 修改为NodePort
kubectl  edit svc jenkins
type: NodePort

# 查看修改后的svc端口
kubectl  get svc | grep jenkins
jenkins         NodePort    10.99.124.103   <none>        8080:31613/TCP   4m24s
jenkins-agent   ClusterIP   10.98.21.139    <none>        50000/TCP        4m23s

# 查看pod名称
kubectl get pod -n default | grep jenkins
jenkins-7db75dbcb9-76l7l                  1/1     Running   0          5m11s

# 查看默认密码
kubectl  exec jenkins-7db75dbcb9-76l7l -- cat /var/jenkins_home/secrets/initialAdminPassword
a9b2d13bc4c9453f93bb83e43a780f7c

# 配置代理
Last login: Mon Oct 31 14:39:53 on ttys000
hansu@HANSU-M-6T0X ~ % nslookup proxy-wsa.esl.cisco.com
Server:		64.104.76.247
Address:	64.104.76.247#53

Non-authoritative answer:
Name:	proxy-wsa.esl.cisco.com
Address: 173.39.121.43

hansu@HANSU-M-6T0X ~ %

# 配置nfs

"nfs/main *(rw,sync,no_subtree_check,no_root_squash)"
root@k8s3:/mnt$exportfs -arv
exporting 10.124.148.144/24:/mnt/postgres
exporting 10.124.148.145/24:/mnt/postgres
exporting 10.124.148.146/24:/mnt/postgres
exporting 10.124.148.144/24:/mnt/gitlab
exporting 10.124.148.145/24:/mnt/gitlab
exporting 10.124.148.146/24:/mnt/gitlab
exporting 10.124.148.144/24:/mnt/nfs_share
exporting 10.124.148.145/24:/mnt/nfs_share
exporting 10.124.148.146/24:/mnt/nfs_share

root@k8s3:/mnt$cat /etc/exports 
# /etc/exports: the access control list for filesystems which may be exported
#               to NFS clients.  See exports(5).
#
# Example for NFSv2 and NFSv3:
# /srv/homes       hostname1(rw,sync,no_subtree_check) hostname2(ro,sync,no_subtree_check)
#
# Example for NFSv4:
# /srv/nfs4        gss/krb5i(rw,sync,fsid=0,crossmnt,no_subtree_check)
# /srv/nfs4/homes  gss/krb5i(rw,sync,no_subtree_check)
/mnt/nfs_share  10.124.148.144/24(rw,sync,no_subtree_check)
/mnt/nfs_share  10.124.148.145/24(rw,sync,no_subtree_check)
/mnt/nfs_share  10.124.148.146/24(rw,sync,no_subtree_check)
/mnt/gitlab     10.124.148.144/24(rw,sync,no_subtree_check)
/mnt/gitlab     10.124.148.145/24(rw,sync,no_subtree_check)
/mnt/gitlab     10.124.148.146/24(rw,sync,no_subtree_check)
/mnt/postgres   10.124.148.144/24(rw,sync,no_subtree_check,no_root_squash)
/mnt/postgres   10.124.148.145/24(rw,sync,no_subtree_check,no_root_squash)
/mnt/postgres   10.124.148.146/24(rw,sync,no_subtree_check,no_root_squash)


# Jenkins config

#!/bin/bash
export KUBECONFIG=/etc/kubernetes/admin.conf
cd test
git pull
docker build -t hansu/nginx-demo:latest .
docker push hansu/nginx-demo:latest
kubectl apply -f middle.yaml
sleep 20
kubectl apply -f app.yaml